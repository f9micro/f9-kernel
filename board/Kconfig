# Copyright (c) 2013 The F9 Microkernel Project. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

menu "Board"

choice
	prompt "Target Board"
	default BOARD_STM32F4DISCOVERY
	help
	  Select the target board for F9 Microkernel.

config BOARD_STM32F4DISCOVERY
	bool "STM32F4 Discovery"
	select PLATFORM_STM32F4
	help
	  STM32F4 Discovery board with STM32F407VGT6 MCU.

config BOARD_STM32F429DISCOVERY
	bool "STM32F429 Discovery"
	select PLATFORM_STM32F429
	help
	  STM32F429 Discovery board with STM32F429ZIT6 MCU and LCD.

config BOARD_NETDUINOPLUS2
	bool "Netduino Plus 2"
	select PLATFORM_STM32F4
	help
	  Netduino Plus 2 board with STM32F405RGT6 MCU.
	  This board is supported by upstream QEMU for emulation.

config BOARD_STM32F429NUCLEO
	bool "STM32F429 Nucleo"
	select PLATFORM_STM32F429
	help
	  STM32F429 Nucleo board with STM32F429ZIT6 MCU.

endchoice

config QEMU
	bool "QEMU emulation mode"
	default y if BOARD_NETDUINOPLUS2
	help
	  Enable workarounds for QEMU emulation limitations:
	  - Use synchronous UART output (QEMU TXE interrupt unreliable)
	  - Place bitmaps in regular SRAM (QEMU lacks CCM RAM emulation)

	  Enable this when running under QEMU. Disable for real hardware
	  to get better performance.

# Hardware feature availability flags
# These control which ARM architecture tests can run based on
# platform capabilities and emulation limitations.

config HAS_PRECISE_TIMING
	bool "Cycle-accurate timing available (DWT/SysTick)"
	default !QEMU
	help
	  Enable tests that require cycle-accurate timing measurements.
	  This covers DWT cycle counter and SysTick precision timing.

	  Tests requiring this feature:
	  - FPU lazy stacking timing (requires DWT cycle counter)
	  - Interrupt latency measurement (requires SysTick precision)

	  Disabled in QEMU because timing is not cycle-accurate.

config MPU_MOCK
	bool "Software MPU mock for testing"
	depends on QEMU
	default y if QEMU
	help
	  Enable minimal MPU register mock for test_arm_mpu_config in QEMU.

	  Returns MPU_TYPE = 0x800 (8 regions, unified) to validate that
	  MPU_TYPE register is readable without QEMU hanging.

	  For full MPU validation, test on real hardware with actual MPU.

config SCB_MOCK
	bool "Software SCB mock for testing"
	depends on QEMU
	default y if QEMU
	help
	  Enable minimal SCB register mock for test_arm_unaligned in QEMU.

	  Returns SCB_CCR = 0x200 (STKALIGN enabled, UNALIGN_TRP disabled)
	  to validate SCB_CCR register readability without QEMU hanging.

	  For full SCB validation, test on real hardware with actual SCB.

endmenu

# Platform symbols (selected by board choice)
config PLATFORM_STM32F4
	bool

config PLATFORM_STM32F429
	bool
